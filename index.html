<!-- <!DOCTYPE html>
<html lang="en">
<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/dataviz.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
<head>
  <title>Emission Data</title>
</head>
    
<body>
    <div id="chartdiv"></div>
    <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
    </style>
  <!-- Chart code -->
<script>
am4core.ready(function() {
    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end

    var chart = am4core.create("chartdiv", am4charts.XYChart);
    chart.dateFormatter.inputDateFormat = "yyyy/MM/dd"
    chart.dataSource.url = "/India_daily_generation-2016-v0.2_20201219.csv";
    chart.dataSource.parser = new am4core.CSVParser();
    chart.dataSource.parser.options.useColumnNames = true;

    //  Create axes
    var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
//     dateAxis.renderer.minGridDistance = 60;

    // Create value axis
    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    valueAxis.title.text = "Emissions";

    // Create series
    createSeries("coal")
    createSeries("gas")
    createSeries("oil")
    createSeries("nuclear")
    createSeries("hydro")
    createSeries("wind")
    createSeries("solar")
    createSeries("other")


    function createSeries(name) {
        var series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.valueY = name;
        series.dataFields.dateX = "date";
        series.tooltipText = name+":{"+name+"}"
        series.name = name;

        chart.cursor = new am4charts.XYCursor();
        chart.cursor.snapToSeries = series;
        chart.cursor.xAxis = dateAxis;
      
        var segment = series.segments.template;
        segment.interactionsEnabled = true;

        var hoverState = segment.states.create("hover");
        hoverState.properties.strokeWidth = 3;

        var dimmed = segment.states.create("dimmed");
        dimmed.properties.stroke = am4core.color("#dadada");

        segment.events.on("over", function(event) {
            processOver(event.target.parent.parent.parent);
        });

        segment.events.on("out", function(event) {
            processOut(event.target.parent.parent.parent);
        });

        return series;
    }

    chart.legend = new am4charts.Legend();
    chart.legend.position = "right";
    chart.legend.scrollable = true;
  
    chart.scrollbarX = new am4core.Scrollbar();
  

    // setTimeout(function() {
    //   chart.legend.markers.getIndex(0).opacity = 0.3;
    // }, 3000)
    chart.legend.markers.template.states.create("dimmed").properties.opacity = 0.3;
    chart.legend.labels.template.states.create("dimmed").properties.opacity = 0.3;

    chart.legend.itemContainers.template.events.on("over", function(event) {
    processOver(event.target.dataItem.dataContext);
    })

    chart.legend.itemContainers.template.events.on("out", function(event) {
    processOut(event.target.dataItem.dataContext);
    })

    function processOver(hoveredSeries) {
    hoveredSeries.toFront();

    hoveredSeries.segments.each(function(segment) {
        segment.setState("hover");
    })
    
    hoveredSeries.legendDataItem.marker.setState("default");
    hoveredSeries.legendDataItem.label.setState("default");

    chart.series.each(function(series) {
        if (series != hoveredSeries) {
        series.segments.each(function(segment) {
            segment.setState("dimmed");
        })
        series.bulletsContainer.setState("dimmed");
        series.legendDataItem.marker.setState("dimmed");
        series.legendDataItem.label.setState("dimmed");
        }
    });
    }

    function processOut() {
    chart.series.each(function(series) {
        series.segments.each(function(segment) {
        segment.setState("default");
        })
        series.bulletsContainer.setState("default");
        series.legendDataItem.marker.setState("default");
        series.legendDataItem.label.setState("default");
    });
    }

    document.getElementById("button").addEventListener("click", function(){
    processOver(chart.series.getIndex(3));
    })
}); // end am4core.ready()
    </script>
</body>

</html>
 -->


<!DOCTYPE html>
<html lang="en">
<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/dataviz.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
<head>
  <title>Indian energy and emissions data</title>
</head>
    
<body>
    <!-- <button type="button" name="seach" onclick="FuncCSVInport()">CSV Import</button>
    <input type="file" id="csvFileInput" onchange="readCSVFile(this)" />
    #csvFileInput{
        position: absolute;
        right: 0px;
        opacity: 0;
    } -->
    <div id="chartdiv"></div>
    <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
    </style>
  <!-- Chart code -->
<script>
am4core.ready(function() {
    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end

    var chart = am4core.create("chartdiv", am4charts.XYChart);
    chart.dateFormatter.inputDateFormat = "yyyy/MM/dd"
    chart.dataSource.url = "/India_daily_generation-2016-v0.2_20201219.csv";
    chart.dataSource.parser = new am4core.CSVParser();
    chart.dataSource.parser.options.useColumnNames = true;
    // var data = [];
    // var value = 50;
    // var value2 = 10;
    // for(var i = 0; i < 300; i++){
    // var date = new Date();
    // date.setHours(0,0,0,0);
    // date.setDate(i);
    // value -= Math.round((Math.random() < 0.5 ? 1 : -1) * Math.random() * 10);
    // value2 -= Math.round((Math.random() < 0.5 ? 1 : -1) * Math.random() * 100);
    // data.push({date:date, value: value,value2:value2});
    // }
    // chart.data = data;

    // // Create axes
    // var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
    // dateAxis.renderer.minGridDistance = 60;
    // // var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    // // categoryAxis.dataFields.category = "date";

    // var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    // valueAxis.title.text = "Emissions";
    // valueAxis.renderer.minLabelPosition = 0.01;


    // // Create axes
    // var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    // categoryAxis.dataFields.category = "year";
    var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
    dateAxis.renderer.minGridDistance = 60;

    // Create value axis
    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    valueAxis.title.text = "Emissions";

    // Create series
    var series1 = chart.series.push(new am4charts.LineSeries());
    series1.dataFields.valueY = "coal";
    series1.dataFields.dateX = "date";
    series1.tooltipText = "coal:{coal}"
    // series1.dataFields.categoryX = "date";
    series1.name = "coal";
    series1.strokeWidth = 3;
    series1.tensionX = 0.7;
    // series1.bullets.push(new am4charts.CircleBullet());

    var series2 = chart.series.push(new am4charts.LineSeries());
    series2.dataFields.valueY = "gas";
    series2.dataFields.dateX = "date";
    // series2.dataFields.categoryX = "date";
    series2.tooltipText = "gas:{gas}"
    series2.name = "gas";
    series2.strokeWidth = 3;
    series2.tensionX = 0.7;
    // series2.bullets.push(new am4charts.CircleBullet());

    var series3 = chart.series.push(new am4charts.LineSeries());
    series3.dataFields.valueY = "oil";
    series3.dataFields.dateX = "date";
    // series3.dataFields.categoryX = "date";
    series3.tooltipText = "oil:{oil}"
    series3.name = "oil";
    series3.strokeWidth = 3;
    series3.tensionX = 0.7;
    // series3.bullets.push(new am4charts.CircleBullet());





    // var series = chart.series.push(new am4charts.LineSeries());
    // series.name = "coal";
    // // series.bullets.push(new am4charts.CircleBullet());
    // series.dataFields.valueY = "value";
    // // series.dataFields.categoryX = "date"
    // series.dataFields.dateX = "date";
    // series.tooltipText = "coal:{value}"
    // series.legendSettings.valueText = "{valueY}";
    // // series.visible  = false;

    // var series2 = chart.series.push(new am4charts.LineSeries());
    // series2.name = "co2";
    // series2.dataFields.valueY = "value2";
    // series2.dataFields.dateX = "date";
    // // series2.dataFields.categoryX = "date"
    // series2.tooltipText = "{value2}"
    // series2.legendSettings.valueText = "{valueY}";

    // series.tooltip.pointerOrientation = "vertical";
    // series2.tooltip.pointerOrientation = "vertical";
    
    // series.propertyFields.fill = "color";
    // series.propertyFields.stroke = "color";

    chart.cursor = new am4charts.XYCursor();
    chart.cursor.snapToSeries = series;
    chart.cursor.xAxis = dateAxis;
    // chart.cursor.behavior = "zoomY";

    //chart.scrollbarY = new am4core.Scrollbar();
    chart.scrollbarX = new am4core.Scrollbar();

    let hs1 = series1.segments.template.states.create("hover")
    hs1.properties.strokeWidth = 5;
    series.segments.template.strokeWidth = 1;

    let hs2 = series2.segments.template.states.create("hover")
    hs2.properties.strokeWidth = 5;
    series2.segments.template.strokeWidth = 1;

    let hs3 = series3.segments.template.states.create("hover")
    hs2.properties.strokeWidth = 5;
    series2.segments.template.strokeWidth = 1;

    chart.legend = new am4charts.Legend();
    chart.legend.itemContainers.template.events.on("over", function(event){
        var segments = event.target.dataItem.dataContext.segments;
        segments.each(function(segment){
        segment.isHover = true;
        })
    })

    chart.legend.itemContainers.template.events.on("out", function(event){
    var segments = event.target.dataItem.dataContext.segments;
    segments.each(function(segment){
        segment.isHover = false;
        })
    })
}); // end am4core.ready()


    function csvToObject(csvString){
        var csvarry = csvString.split("\r\n");
        var datas = [];
        var headers = csvarry[0].split(",");
        for(var i = 1;i<csvarry.length;i++){
            var data = {};
            var temp = csvarry[i].split(",");
                 for(var j = 0;j<temp.length;j++){
                     data[headers[j]] = temp[j];
                 }
            datas.push(data);
        }
         return datas;
    }

     function FuncCSVInport() {
         $("#csvFileInput").val("");
         $("#csvFileInput").click();
     }

     function readCSVFile(obj) {
         var reader = new FileReader();
         reader.readAsText(obj.files[0]);
         reader.onload = function () {
               var data = csvToObject(this.result);
                console.log(data);//data为csv转换后的对象
        }
   }
    </script>
</body>

</html>

